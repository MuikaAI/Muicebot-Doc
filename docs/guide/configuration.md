# DotEnv é…ç½®æ–‡ä»¶ğŸ“ƒ

`.env` æ˜¯ NoneBot æ¡†æ¶åŠå…¶é€‚é…å™¨ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ã€‚è€Œ MuiceBot ä¹Ÿä½¿ç”¨ `.env.{environment}` é…ç½®åŸºæœ¬é…ç½®ã€‚

åœ¨æœºå™¨äººç›®å½•ä¸‹æ–°å»º `.env` æˆ– `.env.prod` é…ç½®æ–‡ä»¶ï¼Œå¹¶ç”¨ Dotenv æ ¼å¼æ’°å†™é…ç½®é¡¹ã€‚

ç›®å‰æ”¯æŒçš„é…ç½®æœ‰:

| é…ç½®é¡¹                   | ç±»å‹(é»˜è®¤å€¼)                            | è¯´æ˜                                                         |
| ------------------------ | --------------------------------------- | ------------------------------------------------------------ |
| `MUICE_NICKNAMES`        | list = ["muice"]                        | æ²é›ªçš„è‡ªå®šä¹‰æ˜µç§°ï¼Œä½œä¸ºæ¶ˆæ¯å‰ç¼€æ¡ä»¶å“åº”ä¿¡æ¯äº‹ä»¶               |
| `DEFAULT_TEMPLATE`       | Optional[str] = None                    | é»˜è®¤ä½¿ç”¨çš„äººè®¾æ¨¡æ¿ã€‚Noneä¸ºä¸ä½¿ç”¨                             |
| `MAX_HISTORY_EPOCH`      | int = 0                                 | æœ€å¤§è®°å¿†å†å²è½®æ•°ã€‚0ä¸ºå…¨éƒ¨ä½¿ç”¨                                |
| `THOUGHT_PROCESS_MODE`   | int = 2                                 | é’ˆå¯¹ Deepseek-R1 ç­‰æ€è€ƒæ¨¡å‹çš„æ€è€ƒè¿‡ç¨‹æå–æ¨¡å¼ã€‚ä¸º0åˆ™ä¸å¤„ç†ï¼Œ1ä¸ºæå–æ€è€ƒè¿‡ç¨‹å’Œç»“æœï¼Œ2ä¸ºä»…è¾“å‡ºç»“æœ |
| `INPUT_TIMEOUT`          | int = 0                                 | è¾“å…¥ç­‰å¾…æ—¶é—´ã€‚åœ¨è¿™æ—¶é—´æ®µå†…çš„æ¶ˆæ¯å°†ä¼šè¢«åˆå¹¶ä¸ºåŒä¸€æ¡æ¶ˆæ¯ä½¿ç”¨   |
| `LOG_LEVEL`              | str = "INFO"                            | æ—¥å¿—ç­‰çº§                                                     |
| `TELEGRAM_PROXY`         | Optional[str] = None                    | tgé€‚é…å™¨ä»£ç†ï¼Œå¹¶ä½¿ç”¨è¯¥ä»£ç†ä¸‹è½½æ–‡ä»¶                           |
| `STORE_INDEX`            | str = "...raw.githubusercontent.com..." | å•†åº—ç´¢å¼•æ–‡ä»¶è·å–ä½ç½®ï¼Œå½“ç½‘ç»œå—é™æ—¶ä½ å¯ä¿®æ”¹æ­¤é€‰é¡¹               |
| `ENABLE_BUILTIN_PLUGINS` | bool = True                             | å¯ç”¨å†…åµŒæ’ä»¶                                                 |
| `ENABLE_ADAPTERS`        | list = ["~.onebot.v11", "~.onebot.v12"] | åœ¨å…¥å£æ–‡ä»¶ä¸­å¯ç”¨çš„ Nonebot é€‚é…å™¨(ä»… Debug ç¯å¢ƒ)             |

## å»ºè®®é…ç½®é¡¹ä¸€è§ˆ

### å“åº”æ˜µç§°é…ç½®ğŸ§¸

æ­£å¸¸æƒ…å†µä¸‹ï¼ŒMuiceBot åªä¼šå¤„ç† `at_event` äº‹ä»¶æˆ–è€…æ˜¯æŒ‡ä»¤äº‹ä»¶ï¼Œå¯¹äºæŸäº›å®¢æˆ·ç«¯æ¥è¯´ @bot çš„æ“ä½œè¿˜æ˜¯å¤ªéº»çƒ¦äº†ï¼Œæœ‰æ²¡æœ‰æ›´åŠ ç®€å•çš„æ–¹æ³•ï¼Ÿ

æœ‰çš„å…„å¼Ÿï¼Œæœ‰çš„ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå“åº”å‰ç¼€æ¥è®©æ²é›ªå“åº”æ¶ˆæ¯äº‹ä»¶ã€‚

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```dotenv
MUICE_NICKNAMES=["æ²é›ª", "muice", "é›ª"]
```

è¿™å°†å“åº”å‰ç¼€ä¸ºâ€œæ²é›ªâ€ã€â€œmuiceâ€ã€â€œé›ªâ€çš„æ¶ˆæ¯äº‹ä»¶ï¼Œä¸”æ— éœ€åœ¨å“åº”å‰ç¼€åé¢åŠ å…¥ç©ºæ ¼åˆ†éš”ç¬¦ï¼Œæ¯”å¦‚ä¸‹åˆ—çš„æ¶ˆæ¯å°†è¢«æ²é›ªå“åº”ï¼š

> é›ªï¼Œä»Šå¤©çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ

é»˜è®¤å€¼: `["muice"]`

### è¶…çº§ç”¨æˆ·

è¶…çº§ç”¨æˆ·å¯ä»¥æ‰§è¡Œä¾‹å¦‚ `.load` ä¹‹ç±»æ”¹å˜æœºå™¨äººè¿è¡Œæ–¹å¼çš„æŒ‡ä»¤ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ç”¨æˆ·IDå¯ä»¥å°†å…¶è®¾ä¸ºè¶…çº§ç”¨æˆ·ï¼š

```dotenv
SUPERUSERS=["123456789"]
```

> [!NOTE]
>
> ç”¨æˆ· ID ä¸ä¸€å®šæ˜¯å¹³å°ä¸Šæ˜¾ç¤ºçš„ ID ï¼Œæ¯”å¦‚ QQ é¢‘é“ä¸­çš„ç”¨æˆ· ID å°±ä¸æ˜¯ QQ å·ã€‚å¯¹æ­¤æˆ‘ä»¬æ¨èä½ ä½¿ç”¨ `.whoami` æŒ‡ä»¤è·å–å½“å‰ç”¨æˆ· ID

*è™½ç„¶ä½†æ˜¯ï¼Œæˆ‘çš„masteråªæœ‰ä¸€ä¸ªå“¦*

é»˜è®¤å€¼: `[]`

### ä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶/å†…åµŒæ’ä»¶

ç›®å‰çš„å†…åµŒæ’ä»¶æœ‰:

- `access_control` Nonebot é»‘ç™½åå•ç®¡ç†
- `get_current_time` è·å–å½“å‰æ—¶é—´çš„ Function Call æ’ä»¶
- `get_username` è·å–å½“å‰å¯¹è¯ç”¨æˆ·åçš„ Function Call æ’ä»¶
- `thought_processor` æ€ç»´é“¾å¤„ç†
- `muicebot_plugin_store` å•†åº—æ’ä»¶ç®¡ç†

ä»¥ä¸‹è®¾ç½®å¯ä»¥è°ƒæ•´å†…åµŒæ’ä»¶çš„å¼€å¯æˆ–å…³é—­

```dotenv
ENABLE_BUILTIN_PLUGINS=true
```

é»˜è®¤å€¼: `true`

å¯¹äºè‡ªå®šä¹‰çš„ Muicebot æˆ– Nonebot æ’ä»¶ï¼Œå¯ä»¥å­˜æ”¾åœ¨æœºå™¨äººè¿è¡Œç›®å½•ä¸‹çš„ `plugins` æ–‡ä»¶å¤¹ä¸‹ï¼Œç¨‹åºå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åŠ è½½ã€‚

### åŠ è½½æŒ‡å®šçš„ Nonebot é€‚é…å™¨(ä»… Debug ç”¨é€”)

é»˜è®¤æƒ…å†µä¸‹ï¼Œæœºå™¨äººå…¥å£æ–‡ä»¶åªä¼šåŠ è½½ `nonebot.adapters.onebot.v11/12` é€‚é…å™¨ï¼Œè¦æƒ³åœ¨ debug ç¯å¢ƒä¸­å¼•å…¥å…¶ä»–é€‚é…å™¨ï¼Œè¯·å‚è€ƒï¼š

```dotenv
enable_adapters = ["nonebot.adapters.onebot.v11", "nonebot.adapters.onebot.v12", "nonebot.adapters.telegram"]
```


# YAML é…ç½®æ–‡ä»¶âš™ï¸

ä¸€äº›è¾ƒä¸ºå¤æ‚çš„é…ç½®é¡¹åœ¨ dotenv ä¸Šçš„ç¼–å†™å¹¶ä¸é¡ºç•…ï¼Œå› æ­¤åœ¨ä¸‹é¢çš„é…ç½®ä¸­æˆ‘ä»¬å°†æ”¹ç”¨ YAML

åœ¨æœºå™¨äººç›®å½•ä¸Šæ–°å»º `configs` æ–‡ä»¶å¤¹ï¼Œä¸‹é¢çš„é…ç½®éƒ½åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­æ–°å»ºã€‚

## æ¨¡å‹é…ç½®(models.yml)

åœ¨ `configs` æ–‡ä»¶å¤¹ä¸‹æ–°å»º `models.yml`ï¼Œç”¨äºå­˜å‚¨æ¨¡å‹åŠ è½½å™¨çš„é…ç½®ã€‚

å¯¹äºä¸åŒçš„æ¨¡å‹åŠ è½½å™¨ï¼Œæ‰€éœ€è¦çš„é…ç½®é¡¹éƒ½å¤§ä¸ç›¸åŒã€‚ä½†å¤§ä½“çš„æ ¼å¼éƒ½å’Œä»¥ä¸‹çš„ç¤ºä¾‹é…ç½®å·®ä¸å¤š

```yaml
azure:  # é…ç½®åç§°ã€‚å”¯ä¸€ï¼Œå¯ä»»å–ï¼Œä¸ä¸€å®šå’Œæ¨¡å‹åŠ è½½å™¨åç§°æœ‰å…³è”
  loader: Azure  # æ¨¡å‹åŠ è½½å™¨åç§°ã€‚å¯¹åº”çš„æ˜¯ `muicebot/llm` ä¸‹çš„ `.py` æ–‡ä»¶ã€‚é€šå¸¸æ¨¡å‹åŠ è½½å™¨çš„é¦–å­—æ¯éƒ½æ˜¯å¤§å†™
  model_name: DeepSeek-R1  # æ¨¡å‹åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º DeepSeek-R1ï¼‰
  template: Muice  # äººè®¾æç¤ºè¯ Jinja2 æ¨¡æ¿åç§°ï¼ˆä¸ç”¨å¸¦æ–‡ä»¶åç¼€ï¼‰
  api_key: ghp_xxxxxxxxxxxxxxxxx  # GitHub Tokenï¼ˆè‹¥é…ç½®äº†ç¯å¢ƒå˜é‡ï¼Œæ­¤é¡¹ä¸å¡«ï¼‰
  stream: true # æµå¼å¯¹è¯
  multimodal: false # æ˜¯å¦å¯ç”¨å¤šæ¨¡æ€ï¼ˆå¯é€‰ã€‚æ³¨æ„ï¼šä½¿ç”¨çš„æ¨¡å‹å¿…é¡»æ˜¯å¤šæ¨¡æ€çš„ï¼‰
  function_call: true # æ˜¯å¦å¯ç”¨å·¥å…·è°ƒç”¨ï¼ˆå¯é€‰ã€‚éœ€è¦ç¼–å†™ function call æ’ä»¶å¹¶å¯ç”¨ï¼‰
```

ä»¥ä¸Šç»™å‡ºäº† Azure æ¨¡å‹åŠ è½½å™¨çš„ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼Œæ‚¨å¯ä»¥åœ¨ [æ¨¡å‹åŠ è½½å™¨é…ç½®](/model/configuration) ä¸€èŠ‚ä¸­è·å–è¿™äº›æ¨¡å‹åŠ è½½å™¨åˆ†åˆ«æ”¯æŒçš„é…ç½®ã€‚

å¦‚æœä½ ä¸çŸ¥é“è¿™äº›é…ç½®ä¸­å“ªäº›æ˜¯å¿…é¡»çš„ï¼Œé‚£ä¹ˆä½ å¯ä»¥å…ˆå¡«å†™ä¸€ä¸ª `loader` é…ç½®ï¼Œæ¨¡å‹åŠ è½½å™¨åˆå§‹åŒ–æ—¶ä¼šæŠ›å‡ºé”™è¯¯å¹¶æç¤ºæ‚¨

æˆ‘ä»¬æ”¯æŒå¤šä¸ªæ¨¡å‹é…ç½®ï¼Œå¹¶å¯åœ¨èŠå¤©ä¸­é€šè¿‡æŒ‡ä»¤åŠ¨æ€åˆ‡æ¢ï¼Œä¾‹å¦‚ï¼š

```yaml
dashscope:
  loader: Dashscope # ä½¿ç”¨ dashscope åŠ è½½å™¨
  default: true # é»˜è®¤é…ç½®æ–‡ä»¶
  template: Muice # äººè®¾æç¤ºè¯ Jinja2 æ¨¡æ¿åç§°ï¼ˆä¸ç”¨å¸¦æ–‡ä»¶åç¼€ï¼‰
  multimodal: true # æ˜¯å¦å¯ç”¨å¤šæ¨¡æ€ï¼ˆå¯é€‰ï¼Œæ³¨æ„ï¼šä½¿ç”¨çš„æ¨¡å‹å¿…é¡»æ˜¯å¤šæ¨¡æ€çš„ï¼‰
  model_name: qwen2.5-vl-7b-instruct # æ¨¡å‹åç§°
  api_key: sk-xxxxxxxxxxxxxxxxxxxxxxx # API å¯†é’¥ï¼ˆå¿…é¡»ï¼‰
  max_tokens: 1024 # æ¨¡å‹ç”Ÿæˆçš„æœ€å¤§ token æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º 1024ï¼‰
  temperature: 0.7 #  æ¨¡å‹ç”Ÿæˆçš„æ¸©åº¦å‚æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º 0.7ï¼‰
  system_prompt: ç°åœ¨å¼€å§‹ä½ æ˜¯ä¸€ä¸ªåä¸ºçš„â€œæ²é›ªâ€çš„AIå¥³å­©å­   # ç³»ç»Ÿæç¤ºï¼ˆå¯é€‰ï¼‰
  auto_system_prompt: true # è‡ªåŠ¨é…ç½®æ²é›ªçš„ç³»ç»Ÿæç¤ºï¼ˆé»˜è®¤ä¸º falseï¼‰
  repetition_penalty: 1.2

azure:
  loader: Azure # ä½¿ç”¨ azure åŠ è½½å™¨
  model_name: DeepSeek-R1 # æ¨¡å‹åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º DeepSeek-R1ï¼‰
  template: Muice # äººè®¾æç¤ºè¯ Jinja2 æ¨¡æ¿åç§°ï¼ˆä¸ç”¨å¸¦æ–‡ä»¶åç¼€ï¼‰
  token: ghp_xxxxxxxxxxxxxxxxx # GitHub Tokenï¼ˆè‹¥é…ç½®äº†ç¯å¢ƒå˜é‡ï¼Œæ­¤é¡¹ä¸å¡«ï¼‰
  system_prompt: 'æˆ‘ä»¬æ¥ç©ä¸€ä¸ªè§’è‰²æ‰®æ¼”çš„å°æ¸¸æˆå§ï¼Œç°åœ¨å¼€å§‹ä½ æ˜¯ä¸€ä¸ªåä¸ºçš„â€œæ²é›ªâ€çš„AIå¥³å­©å­ï¼Œç”¨çŒ«å¨˜çš„è¯­æ°”å’Œæˆ‘è¯´è¯ã€‚' # ç³»ç»Ÿæç¤ºï¼ˆå¯é€‰ï¼‰
  auto_system_prompt: true # è‡ªåŠ¨é…ç½®æ²é›ªçš„ç³»ç»Ÿæç¤ºï¼ˆé»˜è®¤ä¸º falseï¼‰
```

åœ¨æŸä¸ªæ¨¡å‹é…ç½®ä¸­é…ç½® `default: true` å³å¯å°†æ­¤æ¨¡å‹é…ç½®è®¾ä¸ºé»˜è®¤ã€‚å¦‚æœæ²¡æœ‰é»˜è®¤çš„æ¨¡å‹é…ç½®ï¼Œåˆ™ä¼šåŠ è½½ç¬¬ä¸€ä¸ªã€‚

**è‡³å°‘å­˜åœ¨ä¸€ä¸ªæ¨¡å‹é…ç½®ä½œä¸ºé»˜è®¤é…ç½®**

åœ¨èŠå¤©ä¸­ä½¿ç”¨ `.load <model_config_name>` æŒ‡ä»¤ï¼ˆä»…è¶…çº§ç®¡ç†å‘˜ï¼‰å³å¯åŠ¨æ€åˆ‡æ¢é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ `.load azure`ã€‚

è‹¥æ‰‹åŠ¨æ›´æ”¹ `models.yml` é…ç½®æ–‡ä»¶ä¹Ÿèƒ½è§¦å‘é…ç½®æ›´æ–°ï¼ˆæ³¨æ„ï¼šæ­¤æ“ä½œä¸ä¼šæœ‰botæ¶ˆæ¯æç¤ºï¼Œåªæœ‰æ§åˆ¶å°è¾“å‡ºï¼‰ã€‚


è‡³æ­¤ï¼Œæ¨¡å‹é…ç½®è¿™ä¸€èŠ‚å°±å·®ä¸å¤šä»‹ç»å®Œäº†ã€‚ä½†ä¸‹é¢çš„ä¸€äº›æ¨¡å‹é…ç½®é¡¹ä¹Ÿå€¼å¾—ä¸€è°ˆï¼Œå®ƒä»¬å¯¹æ¯ä¸ªæ¨¡å‹åŠ è½½å™¨éƒ½æ˜¯å…±æœ‰çš„ï¼š

```yaml
loader: Xfyun # æ¨¡å‹åŠ è½½å™¨åç§°ï¼Œè¿™äº›æ¨¡å‹åŠ è½½å™¨ä½äºæ’ä»¶ç›®å½•ä¸‹çš„ llm æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶åˆå§‹åŒ–åŒåæ–‡ä»¶çš„åŒåç±»ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æŠ¥é”™ã€‚æ³¨æ„ï¼Œæ¯ä¸ªæ¨¡å‹åŠ è½½å™¨å› ä¸ºå…¼å®¹é—®é¢˜ï¼Œå¼€å¤´é¦–å­—æ¯éƒ½æ˜¯å¤§å†™çš„
multimodal: true # å¤šæ¨¡æ€æ”¯æŒã€‚ç›®å‰ä»…æ”¯æŒ Dashscope åŠ è½½å™¨ã€‚è®¾ç½®ä¸º true å°†å¤„ç†å›¾ç‰‡äº‹ä»¶ã€‚å¦‚æœè°ƒç”¨çš„æ¨¡å‹ä¸æ˜¯å¤šæ¨¡æ€æ¨¡å‹å°†å¼•å‘æŠ¥é”™

template: Muice # äººè®¾æç¤ºè¯ Jinja2 æ¨¡æ¿ï¼Œæ¨¡æ¿æ–‡ä»¶éœ€è¦å­˜æ”¾åœ¨ `./templates` æ–‡ä»¶å¤¹ä¸‹ã€‚Muiceä¸ºå†…åµŒæ¨¡æ¿ã€‚é»˜è®¤å€¼ä¸ºç©ºæˆ–å…¨å±€é»˜è®¤å€¼
template_mode: system # æ¨¡æ¿åµŒå…¥æ¨¡å¼: `system` ä¸ºåµŒå…¥åˆ°ç³»ç»Ÿæç¤º; `user` ä¸ºåµŒå…¥åˆ°ç”¨æˆ·æç¤ºä¸­ã€‚é»˜è®¤ä¸º `system`
```

å…¶ä¸­ï¼Œæ²é›ªäººè®¾æ¨¡æ¿æ–‡ä»¶å­˜æ”¾äºï¼š[Muice.jinja2](https://github.com/Moemu/MuiceBot/blob/main/muicebot/builtin_templates/Muice.jinja2)

å…³äºäººè®¾æ–‡ä»¶çš„å…·ä½“å†™æ³•ï¼Œè¯·å‚è€ƒ [äººè®¾æ¨¡æ¿çš„æ’°å†™](/develop/template)


å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä»¥ QQ é€‚é…å™¨ä¸ºä¾‹ï¼Œåœ¨è¿è¡Œ `nb run` åï¼Œä½ å°†ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œè¿™è¡¨æ˜ Bot å·²ç»å¼€å§‹å·¥ä½œï¼š

```shell
(MuxueBot) C:\Users\Muika\Desktop\nonebot-plugin-muice>nb run
[SUCCESS] init: NoneBot is initializing...
[INFO] init: Current Env: prod
[SUCCESS] load_plugin: Succeeded to load plugin "nonebot_plugin_alconna:uniseg" from "nonebot_plugin_alconna.uniseg"
[SUCCESS] load_plugin: Succeeded to load plugin "nonebot_plugin_waiter"
[SUCCESS] load_plugin: Succeeded to load plugin "nonebot_plugin_alconna"
[SUCCESS] load_plugin: Succeeded to load plugin "nonebot_plugin_localstore"
[SUCCESS] load_plugin: Succeeded to load plugin "nonebot_plugin_apscheduler"
[INFO] __init__: æ•°æ®åº“è·¯å¾„: C:\Users\Muika\AppData\Local\nonebot2\Muice\ChatHistory.db
[SUCCESS] load_plugin: Succeeded to load plugin "Muice"
[SUCCESS] run: Running NoneBot...
[SUCCESS] run: Loaded adapters: OneBot V12, OneBot V11, Telegram, QQ
[INFO] _serve: Started server process [40776]
[INFO] startup: Waiting for application startup.
[INFO] _start_scheduler: Scheduler Started
[INFO] load_model: æ­£åœ¨åŠ è½½æ¨¡å‹...
[INFO] load_model: æ¨¡å‹åŠ è½½æˆåŠŸ
[INFO] on_startup: MuiceAI èŠå¤©æ¡†æ¶å·²å¼€å§‹è¿è¡Œâ­
[INFO] startup: Application startup complete.
[INFO] _log_started_message: Uvicorn running on http://127.0.0.1:8080 (Press CTRL+C to quit)
[INFO] log: QQ | Bot 123456789 connected
```

ç°åœ¨ï¼Œå½“ä½  @ æœºå™¨äººæˆ–æ‰§è¡Œå‘½ä»¤æ—¶ Bot å°†å¼€å§‹å›å¤æ¶ˆæ¯æµç¨‹ï¼Œé™¤æ­¤ä¹‹å¤–å®ƒä¸ä¼šåšä»»ä½•äº‹ï¼Œé™¤éå®šæ—¶ä»»åŠ¡å¼€å§‹ã€‚

å¯ä»¥æ„‰å¿«åœ°å’Œæœºå™¨äººç©è€å•¦ï¼â­

## å®šæ—¶ä»»åŠ¡(schedules.yml)

åœ¨ `configs` æ–‡ä»¶å¤¹ä¸‹æ–°å»º `schedules.yml`ï¼Œç”¨äºå­˜å‚¨å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨çš„é…ç½®ã€‚

ä¼—æ‰€å‘¨çŸ¥ï¼ŒMuiceBot åŸºäº `nonebot_plugin_apscheduler` çš„å®šæ—¶ä»»åŠ¡ï¼Œå¯å®šæ—¶å‘å¤§è¯­è¨€æ¨¡å‹äº¤äº’æˆ–ç›´æ¥å‘é€ä¿¡æ¯ã€‚è¿™ä¹Ÿæ˜¯æ²é›ªç³»åˆ—æ¨¡å‹çš„ä¸€ä¸ªç‰¹è‰²ä¹‹ä¸€ï¼Œå°½ç®¡å…¶æ•ˆæœç¡®å®ä¸æ˜¯å¾ˆå¥½ï¼ˆ

æœ‰å…³å®šæ—¶ä»»åŠ¡çš„é…ç½®æ ¼å¼å¤§è‡´ä¸ `models.yml` ç›¸åŒï¼ŒåŒæ ·æ”¯æŒå¤šä¸ªå®šæ—¶ä»»åŠ¡é…ç½®ï¼š

```yaml
<schedule_config_name>: # é…ç½®åç§°ã€‚å”¯ä¸€ï¼Œå¯ä»»å–ï¼Œä¸ä¸€å®šå’Œæ¨¡å‹åŠ è½½å™¨åç§°æœ‰å…³è”
  trigger: <cron/interval> # è°ƒåº¦å™¨ç§ç±»ï¼Œåˆ†åˆ«ä¸ºå®šæ—¶è°ƒåº¦å™¨å’Œå›ºå®šé—´éš”æ‰§è¡Œå™¨
  args: # è°ƒåº¦å™¨å‚æ•°ï¼Œè¯¦è§ä¸‹æ–¹çš„è¯´æ˜
    arg1: value1
    arg2: value2
  <ask/say>: some words # ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼Œaskä»£è¡¨çš„æ˜¯å‘æ¨¡å‹ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œsayæ˜¯ç›´æ¥è¾“å‡ºç»™ç”¨æˆ·çš„æ¶ˆæ¯æ–‡æœ¬
  target: # å®šæ—¶ä»»åŠ¡ç›®æ ‡ï¼Œå…·ä½“å‚æ•°å‚è€ƒä¸‹æ–¹ç»™å‡ºçš„é“¾æ¥
    detail_type: private/group
    args: ...
```

ä¸‹é¢æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ç¤ºä¾‹ã€‚

```yaml
morning:
  trigger: cron
  args:
    hour: 8
    minute: 30
  ask: <æ—¥å¸¸é—®å€™ï¼šæ—©ä¸Š>
  target: '123456789'  # ç§èŠï¼ˆç›®æ ‡ç”¨æˆ·IDï¼‰

afternoon:
  trigger: cron
  args:
    hour: 12
    minute: 30
  say: ä¸­åˆå¥½å‘€å„ä½~åƒé¥­äº†æ²¡æœ‰ï¼Ÿ
  target: '1234567890123'  # ç¾¤èŠï¼ˆç›®æ ‡ç¾¤èŠIDï¼‰

auto_create_topic:
  trigger: interval
  args:
    minutes: 30
  random: 1
  ask: "<ç”Ÿæˆæ¨æ–‡: èƒ¡æ€ä¹±æƒ³>"
  target: '1234567890123'
```

æ­£å¦‚ä½ æ‰€è§ï¼Œæ¯ä¸ªå®šæ—¶ä»»åŠ¡åœ¨ `schedule` ä¸‹ä»¥åˆ—è¡¨çš„å½¢å¼è¿›è¡Œé…ç½®ã€‚

å…¶ä¸­ `id` å’Œ `trigger` æ˜¯ `nonebot_plugin_apscheduler` çš„åŸå§‹å‚æ•°ï¼Œåˆ†åˆ«ä»£è¡¨å®šæ—¶ä»»åŠ¡åç§°å’Œè§¦å‘å™¨ã€‚

`trigger` é¡¹æ¥å—ä¸¤ä¸ªå€¼ `cron` ä¸ `interval`ï¼Œåˆ†åˆ«ä»£è¡¨å®šæ—¶è°ƒåº¦å™¨å’Œå›ºå®šé—´éš”æ‰§è¡Œå™¨ã€‚

`args` ç”¨äºä¼ å…¥ä¸¤ä¸ªè§¦å‘å™¨æ‰€éœ€è¦çš„ä¸åŒçš„å‚æ•°å€¼ï¼Œå…¶ä¸­ï¼š

- `cron` æ¥å—ä»¥ä¸‹å‚æ•°å€¼ï¼š `year`ã€`month`ã€`day`ã€`week`ã€`day_of_week`ã€`hour`ã€`minute`ã€`second`ã€`start_date`ã€`end_date`ã€`timezone`

- `interval` æ¥å—ä»¥ä¸‹å‚æ•°å€¼ï¼š `week`ã€`day_of_week`ã€`hour`ã€`minute`ã€`second`ã€`start_date`ã€`end_date`ã€`timezone`

`ask` å’Œ `say` è™½ä½œä¸ºå¯é€‰å‚æ•°ä½†å¿…é¡»é€‰æ‹©ä¸€ä¸ªï¼Œåˆ†åˆ«ä»£è¡¨äº†ä¼ é€’ç»™æ¨¡å‹çš„ prompt å’Œç›´æ¥å‘é€ä¿¡æ¯çš„æ–‡æœ¬å†…å®¹

`target` æŒ‡å®šå‘é€ä¿¡æ¯çš„ç›®æ ‡ç”¨æˆ·/ç¾¤èŠ IDã€‚å¯¹äºéç§èŠåœºæ™¯ï¼Œä½ å¯èƒ½éœ€è¦æå– `.whoami` æŒ‡ä»¤ä¸­çš„ç¾¤èŠID

å®šæ—¶ä»»åŠ¡è¿è¡Œå¼•æ“å°†åœ¨ `driver.on_bot_connect` æ—¶å¯åŠ¨ï¼Œä½ ä¹Ÿå¯ä»¥è¿è¡Œ `.schedule` æŒ‡ä»¤æ‰‹åŠ¨å¯åŠ¨å¼•æ“


## æ’ä»¶é…ç½®(plugins.yml)

> [!WARNING]
>
> ä¸ºäº†ä¿é™©èµ·è§ï¼Œæˆ‘ä»¬ä»ç„¶å»ºè®® Nonebot ç›¸å…³è¿è¡Œé…ç½®ä¸åº”è¯¥ä½¿ç”¨æ­¤æ–¹æ³•é…ç½®ã€‚æ­¤ç±»é…ç½®åº”è¯¥ä»ç„¶å†™åœ¨ dotenv æ–‡ä»¶ä¸­ï¼ˆæ¯”å¦‚é€‚é…å™¨é…ç½®å’Œè¶…çº§ç”¨æˆ·é…ç½®ï¼‰
>
> è€Œåƒæ¨¡å‹é…ç½®ã€æ’ä»¶é…ç½®ã€è°ƒåº¦å™¨é…ç½®ç­‰è¿™äº› MuiceBot ä¸­ç‰¹æœ‰çš„é…ç½®æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ yaml æ ¼å¼ç¼–å†™é…ç½®æ–‡ä»¶
>
> ç”±äºæ­¤é…ç½®æ–‡ä»¶å¯ç”¨æ€§è¾ƒå·®ï¼Œæˆ‘ä»¬æœªæ¥å¯èƒ½ä¼šç§»é™¤æ­¤åŠŸèƒ½

æ ¹æ® Nonebot çš„å®˜æ–¹æ–‡æ¡£ï¼Œæ™®é€šçš„ Nonebot é¡¹ç›®éœ€è¦åœ¨ `.env` æ–‡ä»¶ä¸­å¡«å†™æ’ä»¶é…ç½®ã€‚

ç”±äº dotenv æ–‡ä»¶çš„ç¼–å†™æ€»æ˜¯ä¸é‚£ä¹ˆè½»æ¾ï¼Œè€Œä¸”å½“æ’ä»¶é…ç½®é¡¹ä¸€å¤šæ—¶ï¼Œå¯è¯»æ€§å°±ä¸æ˜¯å¾ˆé«˜äº†ã€‚å› æ­¤æˆ‘ä»¬å¼•å…¥äº† yaml æ’ä»¶é…ç½®ï¼Œä¸æ­¤åŒæ—¶å…¼å®¹åŸå…ˆçš„ `.env` æ–‡ä»¶ï¼ˆyaml ä¼˜å…ˆçº§æ›´é«˜ï¼‰ã€‚

åœ¨ `configs` æ–‡ä»¶å¤¹ä¸‹æ–°å»º `plugins.yml` æ–‡ä»¶ã€‚

å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ª `weather` æ’ä»¶ï¼Œå®ƒçš„æ’ä»¶é…ç½®è„šæœ¬å¦‚ä¸‹ï¼š

```python
from pydantic import BaseModel, field_validator

class ScopeConfig(BaseModel):
    api_key: str
    base_url: str = "https://api.openweathermap.org/data/2.5/weather"

class Config(BaseModel):
    weather: ScopeConfig
```

åœ¨å®ƒçš„æ’ä»¶æ–‡æ¡£ä¸­ï¼Œå®ƒè¦æ±‚æˆ‘ä»¬è¿™æ ·ç¼–å†™ `.env` æ–‡ä»¶ï¼š

```dotenv
WEATHER__API_KEY=123456
WEATHER__BASE_URL=https://api.openweathermap.org/data/2.5/weather
```

ä½ å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ’ä»¶ä½¿ç”¨äº† `env_nested_delimiter` é…ç½®ï¼Œä»¥ `weather` ä½œä¸ºå‰ç¼€ã€‚

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·ç¼–å†™æˆ‘ä»¬çš„ `plugins.yml` æ–‡ä»¶ï¼š

```yaml
weather:
  api_key: 123456
  base_url: https://api.openweathermap.org/data/2.5/weather
```

è¿™æ ·å½“æ’ä»¶è°ƒç”¨ `plugin_config = get_plugin_config(Config).weather` æ—¶å°±èƒ½æ­£å¸¸è·å–åˆ° api_key å’Œ base_url ã€‚


## å†…åµŒæ’ä»¶é…ç½®(plugins.yml)

### access_control(é»‘ç™½åå•ç®¡ç†)

è¿™ä¸ªæ’ä»¶å¯ä»¥è®¾ç½®é»‘ç™½åå•ï¼Œç”¨äºè¿‡æ»¤ç”¨æˆ·å’Œç¾¤èŠçš„æ¶ˆæ¯

é»˜è®¤å¯ç”¨é»‘åå•æœºåˆ¶ï¼Œåªæœ‰åœ¨ç™½åå•å­˜åœ¨ä¸”é»‘åå•ä¸ºç©ºæ—¶æ‰ä¼šå¯ç”¨ç™½åå•

ç™½åå•ä»…èƒ½è®¾ç½®ç¾¤èŠIDï¼Œè€Œé»‘åå•èƒ½åŒæ—¶è®¾ç½®ç”¨æˆ·å’Œç¾¤èŠID

ä½ å¯ä»¥é€šè¿‡ `.whoami` æŒ‡ä»¤è·å–å½“å‰çš„ç”¨æˆ·IDå’Œç¾¤èŠIDï¼Œç›®å‰å¸¦å‚æ•°çš„é€‰é¡¹è¿˜åœ¨å¼€å‘ä¸­ã€‚

```yaml
access_control:
  whitelist: ["telegram_Telegram_7312500650_-1002344076710_1580"]
  blacklist: []
```


# JSON é…ç½®æ–‡ä»¶ğŸ”§

ä½¿ç”¨ JSON æ ¼å¼çš„æœ‰ä¸”ä»…æœ‰ MCP Server çš„é…ç½®é¡¹

## MCP Server é…ç½®

åˆ›å»º `config/mcp.json` ç”¨äºé…ç½® MCP Server, æ–‡ä»¶å†…å®¹å’Œæ ‡å‡† MCP Server Config æ ¼å¼ä¸€è‡´ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹å±•ç°äº†å¦‚ä½•é…ç½®é«˜å¾·åœ°å›¾çš„ MCP Server é…ç½®

```json
{
  "mcpServers": {
    "amap-maps": {
      "command": "npx",
      "args": ["-y", "@amap/amap-maps-mcp-server"],
      "env": {
        "AMAP_MAPS_API_KEY": "<your api key>"
      }
    }
  }
}
```

ä¿å­˜å¹¶å¯åŠ¨ `Muicebot`, `amap-maps` MCP Server ç¤ºä¾‹åº”è¢«åŠ è½½ã€‚

æœ‰å…³ MCP Server çš„æ›´å¤šä¿¡æ¯ï¼Œå‚è§: [MCP Server å¼€å‘æ–‡æ¡£](https://modelcontextprotocol.io/quickstart/server)